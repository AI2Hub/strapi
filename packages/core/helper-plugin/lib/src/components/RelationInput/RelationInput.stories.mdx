<!--- RelationsInput.stories.mdx --->

import { useState } from 'react';
import { Meta, ArgsTable, Canvas, Story } from '@storybook/addon-docs';
import { Box } from '@strapi/design-system/Box';
import { Icon } from '@strapi/design-system/Icon';
import { Typography } from '@strapi/design-system/Typography';
import { Badge } from '@strapi/design-system/Badge';
import { BaseLink } from '@strapi/design-system/BaseLink';
import { TextButton } from '@strapi/design-system/TextButton';
import { FieldLabel } from '@strapi/design-system/Field';
import Cross from '@strapi/icons/Cross';
import Refresh from '@strapi/icons/Refresh';

import { Relation, RelationList, RelationItem } from './index';
import { relations as defaultEntries } from './relationsDataMock';
import ReactSelect from './../ReactSelect';

<Meta title="components/RelationInput" />

# RelationInput

WIP

## Usage

<Canvas>
  <Story name="base">
    {() => {
      const [entries, setEntries] = useState(defaultEntries);
      const [relations, setRelations] = useState([]);
      const handleAddRelation = e => {
        setRelations(prev => [...prev, e]);
        const filteredEntries = entries.filter(entry => entry.value !== e.value);
        setEntries(filteredEntries);
      };
      const handleRemoveRelation = relationToRemove => {
        const filteredRelations = relations.filter(relation => relation.value !== relationToRemove.value)
        setRelations(filteredRelations);
        setEntries(prev => [...prev, relationToRemove])
      };
      return (
        <Box maxWidth="60%">
          <Relation
            rightAction={
              <TextButton onClick={() => {}} startIcon={<Refresh />}>
                Load more
              </TextButton>
            }
            leftAction={
              <>
                <FieldLabel htmlFor="articles-relation">{`Articles (${relations.length})`}</FieldLabel>
                <ReactSelect inputId="articles-relation" onChange={handleAddRelation} options={entries} />
              </>
            }
          >           
            <RelationList overflow="top-bottom">
              {relations && relations.map(relation => {
                const { label, status, value } = relation;
                const variant = status === 'published' ? 'success' : 'secondary';
                return (
                  <RelationItem
                    key={value}
                    endAction={
                      <button type="button" onClick={() => handleRemoveRelation(relation)}>
                        <Icon width="12px" as={Cross} />
                      </button>
                    }
                  >
                    <BaseLink href="/">
                      <Typography textColor="primary600">{label}</Typography>
                    </BaseLink>
                    <Badge
                      borderSize={1}
                      borderColor={`${variant}200`}
                      backgroundColor={`${variant}100`}
                      textColor={`${variant}700`}
                    >
                      {status}
                    </Badge>
                  </RelationItem>
                );
              })}
            </RelationList>
          </Relation>
        </Box>
      );
    }}
  </Story>
</Canvas>

### Props

<ArgsTable of={RelationItem} />
